<script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
<style>
  .mermaid-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
  }
  
  .fullscreen-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
    padding: 8px 12px;
    background: #2c3e50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
  
  .fullscreen-btn:hover {
    background: #34495e;
  }
  
  .fullscreen-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    z-index: 9999;
    padding: 20px;
  }
  
  .fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .fullscreen-content {
    position: relative;
    width: 95%;
    height: 95%;
    background: white;
    border-radius: 8px;
    padding: 20px;
    overflow: hidden;
  }
  
  .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10001;
    padding: 10px 15px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
  }
  
  .close-btn:hover {
    background: #c0392b;
  }
  
  .fullscreen-svg-container {
    width: 100%;
    height: 100%;
  }
  .fullscreen-svg-container {
    max-width: 100vw !important;
    height: 100vh !important;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
      document.querySelectorAll('.language-mermaid').forEach((mermaidEl, index) => {
        const svg = mermaidEl.querySelector('svg');
        if (!svg) return;
        
        // Wrap mermaid in container
        const wrapper = document.createElement('div');
        wrapper.className = 'mermaid-wrapper';
        mermaidEl.parentNode.insertBefore(wrapper, mermaidEl);
        wrapper.appendChild(mermaidEl);
        
        // Add fullscreen button
        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'fullscreen-btn';
        fullscreenBtn.innerHTML = '⛶ Fullscreen';
        fullscreenBtn.title = 'View in fullscreen with zoom/pan';
        wrapper.appendChild(fullscreenBtn);
        
        // Create fullscreen modal
        const modal = document.createElement('div');
        modal.className = 'fullscreen-modal';
        modal.innerHTML = `
          <div class="fullscreen-content">
            <button class="close-btn">✕ Close</button>
            <div class="fullscreen-svg-container"></div>
          </div>
        `;
        document.body.appendChild(modal);
        
        const closeBtn = modal.querySelector('.close-btn');
        const svgContainer = modal.querySelector('.fullscreen-svg-container');
        
        let panZoomInstance = null;
        
        // Fullscreen button click
        fullscreenBtn.addEventListener('click', function() {
          // Clone SVG for fullscreen
          const svgClone = svg.cloneNode(true);
          svgContainer.innerHTML = '';
          svgContainer.appendChild(svgClone);
          
          modal.classList.add('active');
          
          // Initialize pan-zoom in fullscreen
          setTimeout(() => {
            panZoomInstance = svgPanZoom(svgClone, {
              zoomEnabled: true,
              controlIconsEnabled: true,
              fit: true,
              center: true,
              minZoom: 0.5,
              maxZoom: 10
            });
          }, 100);
        });
        
        // Close modal
        function closeModal() {
          modal.classList.remove('active');
          if (panZoomInstance) {
            panZoomInstance.destroy();
            panZoomInstance = null;
          }
        }
        
        closeBtn.addEventListener('click', closeModal);
        
        // Close on background click
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            closeModal();
          }
        });
        
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
          }
        });
      });
    }, 1000);
  });
</script>